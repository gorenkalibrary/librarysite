<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="UTF-8">
  <title>Excel → books.json конвертер</title>
</head>
<body>
  <h2>Завантаж <code>books.xlsx</code> для конвертації в books.json</h2>
  <input type="file" id="fileInput" accept=".xlsx" />
  <pre id="output" style="white-space: pre-wrap; background: #f4f4f4; padding: 10px;"></pre>
  <button id="downloadBtn" style="display:none;">Завантажити books.json</button>

  <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
  <script>
    document.getElementById('fileInput').addEventListener('change', function (e) {
      const file = e.target.files[0];
      if (!file) return;

      const reader = new FileReader();
      reader.onload = function (e) {
        const data = new Uint8Array(e.target.result);
        const workbook = XLSX.read(data, { type: 'array' });
        const sheet = workbook.Sheets[workbook.SheetNames[0]];
        const rawBooks = XLSX.utils.sheet_to_json(sheet);

        const converted = rawBooks.map(book => {
          const authorsRaw = book.author || book.authors || '';
          const authors = authorsRaw.split(',').map(a => a.trim()).filter(Boolean);
          const { author, ...rest } = book;
          return { ...rest, authors };
        });

        const jsonString = JSON.stringify(converted, null, 2);
        document.getElementById('output').textContent = jsonString;
        const blob = new Blob([jsonString], { type: 'application/json' });
        const url = URL.createObjectURL(blob);

        const btn = document.getElementById('downloadBtn');
        btn.style.display = 'inline-block';
        btn.onclick = () => {
          const a = document.createElement('a');
          a.href = url;
          a.download = 'books.json';
          a.click();
        };
      };
      reader.readAsArrayBuffer(file);
    });
  </script>
</body>
</html>
