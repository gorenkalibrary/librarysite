<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="UTF-8">
  <title>Конвертер Excel у JSON</title>
</head>
<body>
  <h2>Завантаж Excel (books.xlsx)</h2>
  <input type="file" id="upload" accept=".xlsx" />
  <pre id="output" style="white-space: pre-wrap;"></pre>
  <a id="downloadLink" style="display:none;" download="books.json">⬇️ Завантажити books.json</a>

  <script src="https://cdn.sheetjs.com/xlsx-latest/package/dist/xlsx.full.min.js"></script>
  <script>
    document.getElementById('upload').addEventListener('change', async (e) => {
      const file = e.target.files[0];
      const reader = new FileReader();

      reader.onload = function (e) {
        const data = new Uint8Array(e.target.result);
        const workbook = XLSX.read(data, { type: 'array' });
        const sheet = workbook.Sheets[workbook.SheetNames[0]];
        let books = XLSX.utils.sheet_to_json(sheet);

        const today = new Date().toISOString().split('T')[0];

        books = books.map(book => {
          // Поле "authors" — масив, якщо є кілька авторів через кому
          if (book.authors && typeof book.authors === 'string') {
            book.authors = book.authors.split(',').map(a => a.trim());
          }

          // Додаємо поле "added" лише якщо його нема
          if (!book.added) {
            book.added = today;
          }

          return book;
        });

        const json = JSON.stringify(books, null, 2);
        document.getElementById('output').textContent = json;

        const blob = new Blob([json], { type: 'application/json' });
        const url = URL.createObjectURL(blob);
        const link = document.getElementById('downloadLink');
        link.href = url;
        link.style.display = 'inline';
      };

      reader.readAsArrayBuffer(file);
    });
  </script>
</body>
</html>
