<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="UTF-8">
  <title>Excel → JSON конвертер для бібліотеки</title>
</head>
<body>
  <h2>Завантажте Excel-файл</h2>
  <input type="file" id="fileInput" accept=".xlsx, .xls">
  <button onclick="generateJSON()">Створити JSON</button>
  <pre id="output" style="white-space: pre-wrap; background: #f4f4f4; padding: 10px; margin-top: 1rem;"></pre>
  <a id="downloadLink" style="display:none;" download="books.json">⬇️ Завантажити books.json</a>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
  <script>
    let jsonData = [];

    function parseCellArray(value) {
      return value ? value.split(',').map(v => v.trim()).filter(Boolean) : [];
    }

    function generateJSON() {
      const fileInput = document.getElementById('fileInput');
      if (!fileInput.files.length) {
        alert('Будь ласка, виберіть Excel-файл.');
        return;
      }

      const reader = new FileReader();
      reader.onload = function(e) {
        const data = new Uint8Array(e.target.result);
        const workbook = XLSX.read(data, { type: 'array' });
        const sheet = workbook.Sheets[workbook.SheetNames[0]];
        const rows = XLSX.utils.sheet_to_json(sheet, { defval: '' });

        jsonData = rows.map(row => ({
          title: row.title || '',
          author: parseCellArray(row.author),
          publisher: row.publisher || '',
          year: row.year?.toString() || '',
          language: row.language || '',
          genre: parseCellArray(row.genre),
          image: row.image || '',
          description: row.description || '',
          added: row.added || ''
        }));

        const jsonString = JSON.stringify(jsonData, null, 2);
        document.getElementById('output').textContent = jsonString;

        const blob = new Blob([jsonString], { type: 'application/json' });
        const url = URL.createObjectURL(blob);
        const downloadLink = document.getElementById('downloadLink');
        downloadLink.href = url;
        downloadLink.style.display = 'inline-block';
        downloadLink.textContent = '⬇️ Завантажити books.json';
      };

      reader.readAsArrayBuffer(fileInput.files[0]);
    }
  </script>
</body>
</html>
